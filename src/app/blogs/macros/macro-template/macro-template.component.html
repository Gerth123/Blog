<ng-container *ngIf="macro() as m; else loading">
  <!-- HERO -->
  <section class="macro-hero py-4 py-lg-5 bg-ivory border-bottom">
    <div class="container">
      <div class="row align-items-center gy-3">
        <div class="col-auto">
          <div class="symbol-circle shadow-sm">
            {{ m.name ? m.name[0] : '?' }}
          </div>
        </div>

        <div class="col">
          <h1 class="display-6 fw-bold mb-0">
            {{ m.name }}
            <small class="text-accent ms-2" *ngIf="m.unit">({{ m.unit }})</small>
          </h1>
          <div class="text-muted">Makronährstoff</div>
        </div>

        <div class="col-auto" *ngIf="m.kcalPerGram !== undefined">
          <span class="badge text-bg-light border">
            {{ m.kcalPerGram }} kcal&nbsp;/&nbsp;g
          </span>
        </div>
      </div>
    </div>
  </section>

  <!-- MAIN -->
  <div class="container my-4 my-lg-5">
    <div class="row g-4">
      <!-- LEFT: Beschreibung -->
      <div class="col-lg-7">
        <article class="card card-body bg-soft mb-3">
          <h2 class="h5 text-accent mb-3">Rolle im Ernährungsalltag</h2>
          <p class="mb-0">{{ m.desc }}</p>
        </article>

        <div *ngIf="m.notes" class="alert alert-info shadow-sm" role="note">
          <div class="fw-semibold mb-1">Praxis / Leitlinien</div>
          <div>{{ m.notes }}</div>
        </div>
      </div>

      <!-- RIGHT: Sidebar Facts -->
      <aside class="col-lg-5">
        <div class="d-grid gap-3 position-lg-sticky" style="top: 1.25rem;">
          <!-- Energie & Einheit -->
          <div class="card shadow-sm">
            <div class="card-header bg-ivory fw-semibold text-accent">Energie &amp; Einheit</div>
            <div class="card-body">
              <table class="table table-sm align-middle mb-0">
                <tbody>
                  <tr>
                    <th scope="row">Energiedichte</th>
                    <td class="text-end">
                      <ng-container *ngIf="m.kcalPerGram !== undefined; else noKcal">
                        {{ m.kcalPerGram }} kcal/g
                      </ng-container>
                      <ng-template #noKcal>–</ng-template>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">Standard-Einheit</th>
                    <td class="text-end">{{ m.unit || 'g' }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Typische Quellen -->
          <div class="card shadow-sm">
            <div class="card-header bg-ivory fw-semibold text-accent">Typische Quellen</div>
            <ul class="list-group list-group-flush" *ngIf="m.sources?.length; else noSrc">
              <li class="list-group-item" *ngFor="let s of m.sources">• {{ s }}</li>
            </ul>
            <ng-template #noSrc>
              <div class="card-body text-muted">Keine Angaben.</div>
            </ng-template>
          </div>
        </div>
      </aside>
    </div>
  </div>
</ng-container>

<ng-template #loading>
  <div class="container py-5 text-center text-muted">Lade Makronährstoff…</div>
</ng-template>
