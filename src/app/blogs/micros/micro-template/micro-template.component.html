<ng-container *ngIf="micro() as m; else loading">
  <!-- HERO -->
  <section class="micro-hero py-4 py-lg-5 bg-ivory border-bottom">
    <div class="container">
      <div class="row align-items-center gy-3">
        <div class="col-auto">
          <div class="symbol-circle shadow-sm">
            {{ m.symbol || (m.name ? m.name[0] : '?') }}
          </div>
        </div>
        <div class="col">
          <h1 class="display-6 fw-bold mb-0">
            {{ m.name }}
            <small class="text-accent ms-2">({{ m.symbol || '' }})</small>
          </h1>
          <div class="text-muted">{{ m.category || 'Mikronährstoff' }}</div>
        </div>
      </div>
    </div>
  </section>

  <!-- MAIN -->
  <div class="container my-4 my-lg-5">
    <div class="row g-4">
      <!-- LEFT: Beschreibung -->
      <div class="col-lg-7">
        <article class="card card-body bg-soft mb-3">
          <h2 class="h5 text-accent mb-3">Im Körper</h2>
          <p class="mb-0">{{ m.desc }}</p>
        </article>

        <div *ngIf="m.notes" class="alert alert-warning shadow-sm" role="note">
          <div class="fw-semibold mb-1">Besondere Hinweise</div>
          <div>{{ m.notes }}</div>
        </div>
      </div>

      <!-- RIGHT: Sidebar Facts -->
      <aside class="col-lg-5">
        <div class="d-grid gap-3 position-lg-sticky" style="top: 1.25rem;">
          <!-- Funktionen -->
          <div class="card shadow-sm">
            <div class="card-header bg-ivory fw-semibold text-accent">Funktionen</div>
            <ul class="list-group list-group-flush" *ngIf="m.functions?.length; else noFuncs">
              <li class="list-group-item" *ngFor="let f of m.functions">• {{ f }}</li>
            </ul>
            <ng-template #noFuncs><div class="card-body text-muted">Keine Angaben.</div></ng-template>
          </div>

          <!-- Quellen -->
          <div class="card shadow-sm">
            <div class="card-header bg-ivory fw-semibold text-accent">Wichtige Nahrungsquellen</div>
            <ul class="list-group list-group-flush" *ngIf="m.sources?.length; else noSrc">
              <li class="list-group-item" *ngFor="let s of m.sources">• {{ s }}</li>
            </ul>
            <ng-template #noSrc><div class="card-body text-muted">Keine Angaben.</div></ng-template>
          </div>

          <!-- Referenzwerte -->
          <div class="card shadow-sm">
            <div class="card-header bg-ivory fw-semibold text-accent">Referenzwerte pro Tag</div>
            <div class="card-body">
              <table class="table table-sm align-middle mb-0">
                <tbody>
                <tr>
                  <th scope="row">Erwachsene (w)</th>
                  <td class="text-end">
                    {{ m.rda?.female ?? '–' }}
                    {{ m.rda?.unit ?? m.unit ?? 'mg' }}
                  </td>
                </tr>
                <tr>
                  <th scope="row">Erwachsene (m)</th>
                  <td class="text-end">
                    {{ m.rda?.male ?? '–' }}
                    {{ m.rda?.unit ?? m.unit ?? 'mg' }}
                  </td>
                </tr>
                <tr *ngIf="m.rda?.pregnant">
                  <th scope="row">Schwangere</th>
                  <td class="text-end">
                    {{ m.rda?.pregnant }}
                    {{ m.rda?.unit ?? m.unit ?? 'mg' }}
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Versorgungssituation in D -->
          <div class="card shadow-sm">
            <div class="card-header bg-ivory fw-semibold text-accent">Versorgungssituation in D</div>
            <div class="card-body d-flex gap-2">
              <div class="supply-box" [class.active]="m.supply?.de === 'niedrig'">↓</div>
              <div class="supply-box" [class.active]="m.supply?.de === 'mittel'">≈</div>
              <div class="supply-box" [class.active]="m.supply?.de === 'gut'">↑</div>
              <div class="ms-2 align-self-center text-muted small">
                <ng-container *ngIf="m.supply?.de as de; else noSupply">Aktuell: {{ de }}</ng-container>
                <ng-template #noSupply>Keine Daten</ng-template>
              </div>
            </div>
          </div>

          <!-- Risikogruppen -->
          <div class="card shadow-sm" *ngIf="m.riskGroups?.length">
            <div class="card-header bg-ivory fw-semibold text-accent">Risikogruppen</div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item" *ngFor="let r of m.riskGroups">• {{ r }}</li>
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </div>
</ng-container>

<ng-template #loading>
  <div class="container py-5 text-center text-muted">Lade Mikronährstoff…</div>
</ng-template>
